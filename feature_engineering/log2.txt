## 增删数据实验

删除和card_str相关的特征:
Total training time is 0:26:35.179555
AUCs: [0.9165927563426568, 0.9356567520478474, 0.9529700396869814, 0.9497215235237011]
Mean AUC: 0.9387352679002967
------------------------------
test1 auc:  0.905857583882158
test2 auc: 0.9077567908811621
实验结果分析: 删除之后test1提升1个点,test2提高7个点; 把这部分特征删掉

删除shift_100_cnt:
Total training time is 0:29:54.875283
AUCs: [0.915722542088632, 0.9340769918155528, 0.9522404516192993, 0.9491112465372289]
Mean AUC: 0.9377878080151782
------------------------------
test1 auc:  0.9055729658792255
test2 auc: 0.9074243216793929
实验结果分析: 删除之后test1降低2个点,test2提高3个点,把这部分特征删掉


删除D1-D15:
Total training time is 0:30:04.072408
AUCs: [0.917060263076479, 0.9343770720640229, 0.9521836074538611, 0.9484340926568431]
Mean AUC: 0.9380137588128015
------------------------------
test1 auc:  0.9053661531335239
test2 auc: 0.9071125853532404
实验结果分析: 删除之后test1下降4个点,test2提高1个点,随机因素比较大...


删除"M*_count_full"
Total training time is 0:59:56.122932
AUCs: [0.9162777503780114, 0.9357271294571907, 0.9530573846247327, 0.949787743597217]
Mean AUC: 0.9387125020142879
------------------------------
test1 auc:  0.9052314695503172
test2 auc: 0.907141068803422
实验结果分析: 删除之后test1降低5个点,test2提高1个点;不删


增加特征[discussion区 + 2-sigma 比赛中的highlight]
AUCs: [0.9182331512648755, 0.9355833084628401, 0.9526952209327242, 0.9494401807949852]
Mean AUC: 0.9389879653638562
------------------------------
test1 auc:  0.9066202179342023
test2 auc: 0.9076443247197925
实验结果分析: 增加之后test1提高8个点,test2提高1个点,增加该特征


增加特征,Hour_count_full特征
Total training time is 0:27:30.369639
AUCs: [0.9168075258569042, 0.9347698462739565, 0.9529136592292219, 0.9500889446617915]
Mean AUC: 0.9386449940054685
------------------------------
test1 auc:  0.9061780778221262
test2 auc: 0.9075559856983434
实验结果分析: 增加之后test1降低5个点,test2降低1个点,不增加该特征


增加特征, D10和TransactionDT的关系
Total training time is 0:25:32.618150
AUCs: [0.916843091218672, 0.9355654176171028, 0.953596556730637, 0.9498196413112193]
Mean AUC: 0.9389561767194078
------------------------------
test1 auc:  0.9070889946090179
test2 auc: 0.9082865109137566
实验结果分析: 增加之后test1提高4个点,test2提高6个点,增加该特征


增加特征, DT
Total training time is 0:25:26.122152
AUCs: [0.9195220993399171, 0.9397062155358059, 0.950584967236654, 0.950496934940626]
Mean AUC: 0.9400775542632508
------------------------------
test1 auc:  0.9072946084159499
test2 auc: 0.907713717667147
实验结果分析: 增加之后test1提高2个点,test2降低5个点,DT不能直接用

删除DT特征,增加D1-D5的角度特征
AUCs: [0.9183270241741106, 0.937842110899958, 0.9533913261080216, 0.9514091955861894]
Mean AUC: 0.9402424141920699
------------------------------
test1 auc:  0.9078200454278738
test2 auc: 0.909537246649041
实验结果分析: D1_slop - D5_slop特征有效


保留DT特征,增加D10_delta特征:
Total training time is 0:27:06.646978
AUCs: [0.9204893682737583, 0.9387942741483568, 0.9518110982836421, 0.9509581765838441]
Mean AUC: 0.9405132293224002
------------------------------
test1 auc:  0.9078516621978111
test2 auc: 0.9088840184573507
实验结果分析: D10_delta特征有效


保留DT特征,增加D1-D8的delta特征:
Total training time is 0:25:39.168876
AUCs: [0.9214120817423768, 0.9410455557772427, 0.9527808229692002, 0.9526738403752025]
Mean AUC: 0.9419780752160055
------------------------------
test1 auc:  0.9098886088626258
test2 auc: 0.9111684616815487
实验结果分析: D1-D8的delta特征有效


增加剩余的D系列特征
Total training time is 0:28:31.895342
AUCs: [0.9201963357448736, 0.940414068221396, 0.9525779748446579, 0.952460352783546]
Mean AUC: 0.9414121828986184
------------------------------
test1 auc:  0.9092219821382269
test2 auc: 0.9113189213124299
实验结果分析: 剩余的D系列特征 test1和test2变化很小

删除TransactionDT的实验,和楼上的楼上对比
Total training time is 0:29:06.701988
AUCs: [0.9193831798196649, 0.9398473174687186, 0.9524379111408169, 0.9519287754581489]
Mean AUC: 0.9408992959718373
------------------------------
test1 auc:  0.9093046921449708
test2 auc: 0.9113783016866946
实验结果分析: 删除TransactionDT test1和test2变化很小


线下平移D10 90的距离
Total training time is 0:27:23.509578
AUCs: [0.9204108063008111, 0.939438040869952, 0.9527022085277441, 0.9523018075194254]
Mean AUC: 0.9412132158044831
------------------------------
test1 auc:  0.9088
test2 auc: 0.9117
实验结果分析: test1降低10个点,test2降低6个点,平移暂时无效

增加D10的01特征:
Total training time is 0:25:44.534128
AUCs: [0.9190252946917475, 0.9393652047348404, 0.9525140071698801, 0.952668103677898]
Mean AUC: 0.9408931525685915
------------------------------
test1 auc:  0.909048597146898
test2 auc: 0.9115259618094353
实验结果分析: 没有明显提升


修改D10的slop特征
Total training time is 0:27:59.829331
AUCs: [0.9198029493176832, 0.9406284257191105, 0.9531836730125329, 0.9522789026549128]
Mean AUC: 0.9414734876760599
------------------------------
test1 auc:  0.9086360448314562
test2 auc: 0.910843902635427
实验结果分析: test1降低12个点,test2降低3个点


增加剩余的delta特征:
Total training time is 0:28:53.156893
AUCs: [0.9198741761349613, 0.9401853488725768, 0.9523983041090895, 0.9518010099158638]
Mean AUC: 0.9410647097581228
------------------------------
test1 auc:  0.9089784550367694
test2 auc: 0.9116157066642341
实验结果分析: test1降低9个点,test2提升5个点, 剩余的delta特征

删除特征:
card_str相关的特征
shift_100_cnt

增加特征:

label_encoding_features:
['ProductCD', 'card4', 'card6', 'P_emaildomain', 'R_emaildomain',
'M1', 'M2', 'M3', 'M4', 'M5', 'M6', 'M7', 'M8', 'M9',
'id_12', 'id_15', 'id_16', 'id_23', 'id_27', 'id_28', 'id_29', 'id_30', 'id_31',
'id_33', 'id_34', 'id_35', 'id_36', 'id_37', 'id_38', 'DeviceType', 'DeviceInfo',
'card1_sub_-1', 'card1_sub_-2', 'card1_sub_-3', 'card1_sub_-4', 'card1_sub_-5',
'card1_first', 'P_email_suffix', 'P_emailCorp', 'R_email_suffix', 'R_emailCorp',
'System', 'SystemCorp', 'LastestBrowser', 'MSBrowser', 'AppleBrowser', 'GoogleBrowser',
'BrowserType', 'id_02__id_20', 'id_13__id_17', 'id_02__D8', 'D11__DeviceInfo',
'DeviceInfo__P_emaildomain', 'card2__dist1', 'card1__card5', 'card2__id_20',
'card5__P_emaildomain', 'addr1__card1', 'id_30_DeviceTpye', 'id_31_DeviceTpye',
'id_33_DeviceTpye', 'DeviceInfo_DeviceTpye', 'DeviceCorp']

card3特征onehot编码
Total training time is 0:27:54.949439
AUCs: [0.9200992490338095, 0.9404890882835136, 0.9531687544172154, 0.9523492942367]
Mean AUC: 0.9415265964928097
------------------------------
test1 auc:  0.9087788275394995
test2 auc: 0.9109158691443733
实验结果分析: 四折均有提升, mean auc提升, test1 提升7个点,test2下降4个点

增加D10/当日最大值
Total training time is 0:28:04.523583
AUCs: [0.9200371617991412, 0.9398790639573149, 0.9527518252493626, 0.9527141789300625]
Mean AUC: 0.9413455574839703
------------------------------
test1 auc:  0.9089329121318903
test2 auc: 0.9109703430335961
实验结果分析:只有第一折提升,test1 提升9个点,test2下降4个点

uid_D15特征
Total training time is 0:29:09.250839
AUCs: [0.9197335909898408, 0.9405412566590792, 0.9528778657934037, 0.9525106344812374]
Mean AUC: 0.9414158369808903
------------------------------
test1 auc:  0.9111782477696009
test2 auc: 0.9141366110578519
实验结果分析: test1 提升31个点,test2提升28个点


删除大量特征
Total training time is 0:25:57.590022
AUCs: [0.9224166670795139, 0.9377118707497039, 0.9515993037988852, 0.9511486684741246]
Mean AUC: 0.9407191275255569
------------------------------
test1 auc:  0.9102312705935549
test2 auc: 0.9127332871840039
实验结果分析: 删除了有用的特征,效果降低

uid_D15特征构造_优化day列.py
移动12个小时
python -u uid_D15build_enhanced_day.py > uid_D15build_enhanced_day.log 2>&1 &
output:uid_D15_test_modify.csv和uid_D15_train_modify.csv

通过D10发现fraud样本
nohup python -u D10_find_fraud.py > D10_find_fraud.log 2>&1 &
生成fraud_TransactionIDs.csv文件

uid_D15_modify
Total training time is 0:29:29.511434
AUCs: [0.9196043555834051, 0.9403867040499045, 0.9533501840439786, 0.9529223211216726]
Mean AUC: 0.9415658911997402
------------------------------
test1 auc:  0.9118566039718946
test2 auc: 0.915351226754878
实验结果分析: test1提升7个点, test2提升12个点, 平移12个小时有效

增加D10和D15特征,DAY取消120的限制
Total training time is 0:33:34.194082
AUCs: [0.919316544147857, 0.9404758690167362, 0.9527192777672955, 0.9522664789669618]
Mean AUC: 0.9411945424747127
------------------------------
test1 auc:  0.9116865475028848
test2 auc: 0.9177795477768474
实验结果分析: test1提升5个点,test2提升36个点,uid_D10特征有效

增加uid_D1,D2特征
Total training time is 0:30:16.070644
AUCs: [0.9197210988033296, 0.9399530860660322, 0.9520021618371779, 0.9526416491882567]
Mean AUC: 0.9410794989736991
------------------------------
test1 auc:  0.9128128372906109
test2 auc: 0.9208794250045345
实验结果分析: test1提升16个点,test2提升67个点,uid_D1,D2特征有效


增加uid_D3,D4特征
Total training time is 0:33:00.055205
AUCs: [0.9189331514698756, 0.9395349435914072, 0.9523776371375484, 0.9534091717729564]
Mean AUC: 0.941063725992947
------------------------------
test1 auc:  0.9136731052026178
test2 auc: 0.9223522515060686
实验结果分析: test1提升8个点,test2提升15个点,
uid_D3,D4特征有效


构造更多的uid_Dxx特征
实验获得数据:
D1,D2,D3,D4,D10,D15,  D5,D6,D7,D8,D11,D12,D13,D14

构造uid_D10_Amount特征
Output:uid_D10_TransactionAmt_test.csv, uid_D10_TransactionAmt_train.csv


增加uid_D5,D6特征
Total training time is 0:34:53.652975
AUCs: [0.9178960864478097, 0.9393987157207526, 0.951968359146394, 0.9533484578108607]
Mean AUC: 0.9406529047814542
------------------------------
test1 auc:  0.9134728740438693
test2 auc: 0.9219674842904771
实验结果分析: D5,D6特征增加后结果下降

增加uid_D10_Amount特征
Total training time is 0:28:13.552965
AUCs: [0.920233822981489, 0.9396614522637309, 0.952513711356361, 0.9532863812958122]
Mean AUC: 0.9414238419743483
------------------------------
test1 auc:  0.9137263867122839
test2 auc: 0.9218922217989103
实验结果分析: test1提升0.5点,test2降低4个点, uid_D10_Amount特征无效

增加uid_D7,D8特征
Total training time is 0:32:27.041584
AUCs: [0.919465873823535, 0.9397038146624085, 0.9521655388443124, 0.9532430451244558]
Mean AUC: 0.9411445681136779
------------------------------
test1 auc:  0.9139286384601479
test2 auc: 0.9219990230851388
实验结果分析: test1提升2.5点,test2降低3.6个点, uid_D7,D8特征无效

增加uid_D11,D12特征
Total training time is 0:35:28.721567
AUCs: [0.9184916434319116, 0.9392928169556043, 0.9522655158188277, 0.9536998986484202]
Mean AUC: 0.9409374687136909
------------------------------
test1 auc:  0.9134795646252563
test2 auc: 0.9219974814812167
实验结果分析: test1降低2个点,test2降低3.6个点, uid_D11,D12特征无效

增加uid_D13,D14特征
Total training time is 0:29:08.145754
AUCs: [0.9183730637537989, 0.9395971927426225, 0.9521834475546614, 0.9538229686236057]
Mean AUC: 0.9409941681686722
------------------------------
test1 auc:  0.9132142637896364
test2 auc: 0.9218828409642665
实验结果分析: test1降低4.6个点, test2降低4.7个点, D13,D14无效


把uid_D3去掉:
Total training time is 0:33:04.762089
AUCs: [0.9197976000993566, 0.9400581748979862, 0.9520007307393418, 0.952898347177151]
Mean AUC: 0.9411887132284589
------------------------------
test1 auc:  0.9127553888399056
test2 auc: 0.9213061985206149
实验结果分析: uid_D3特征去掉后结果下降,说明uid_D3有效

增加 用户当天交易信息 特征
Total training time is 0:32:07.760490
AUCs: [0.9186444538364806, 0.9393143235745303, 0.952649505751574, 0.9534948309352682]
Mean AUC: 0.9410257785244633
------------------------------
test1 auc:  0.9145753192031942
test2 auc: 0.9221200463388004
实验结果分析: test1提升9个点, test2降低2.3个点,无法证明能提升效果


构造uid_D10特征,1到30天前的数据,train用label的数据; test用预测值的数据,计算mean_,sum_,count_
实验结果分析: 上线提交效果很差 考虑是过度加权

uid的target encoding, fraud的mean, count, sum
Total training time is 0:27:38.976173
AUCs: [0.9744989416021672, 0.9756051448402808, 0.9810714285714285, 0.9833468778084312]
Mean AUC: 0.978630598205577
------------------------------
test1 auc:  0.8420500709360927
test2 auc: 0.8275442825789878
实验结果分析: target encoding发生了严重的过拟合

构造uid_D10,D15特征,修改uid的构造:增加pEmail
Output: train_target_encoding_D15_pEmail, test_target_encoding_D15_pEmail
train_target_encoding_D10_pEmail, test_target_encoding_D10_pEmail

上一笔交易的信息,通过uid和D10查到有且仅有一条信息时可以获取到
Output:uid_D10_TransactionAmt_test.csv, uid_D10_TransactionAmt_train.csv

增加构造uid_D10,D15特征,修改uid的构造:增加pEmail
Total training time is 0:33:27.351415
AUCs: [0.918022535135716, 0.9396955128471675, 0.9520390505825126, 0.9538164702941376]
Mean AUC: 0.9408933922148834
------------------------------
test1 auc:  0.9138420717272916
test2 auc: 0.9224118851836399
实验结果分析: test1提高2个点,test2提高1个点,uid的构造增加pEmail特征有效


增加特征: 上一笔交易的金额,通过uid和D10查到有且仅有一条信息时可以获取到
Total training time is 0:58:09.955139
AUCs: [0.9184100278133729, 0.9395455884276745, 0.9527819822383969, 0.9532271696356904]
Mean AUC: 0.9409911920287837
------------------------------
test1 auc:  0.9143082409198876
test2 auc: 0.9219629521877217
实验结果分析: test1提高7个点,test2降低4个点,不能证明该特征有效


构造uid_D1,D2,D3,D4特征,修改uid的构造:增加pEmail
Output: train_target_encoding_D1,D2,D3,D4_pEmail, test_target_encoding_D1,D2,D3,D4_pEmail


增加构造uid_D1,D2,D3,D4特征,修改uid的构造:增加pEmail
Total training time is 0:31:36.351492
AUCs: [0.9196850850040973, 0.9394218566691599, 0.9525038375807892, 0.9532493617801968]
Mean AUC: 0.9412150352585609
------------------------------
test1 auc:  0.913384186111651
test2 auc: 0.922965428898794
实验结果分析: test1降低4.6个点, test2提高5.5个点

构造uid_D15,D10特征,修改uid的构造:只用card
output:train_target_encoding_D15,D10_card.csv,test_target_encoding_D15,D10_card

shift 12个小时依然会出现部分数据不匹配的情况,增加(df["day"] == DAY - D1 + 1)的判定条件
Output:train_target_encoding_D15,D10_shift.csv,test_target_encoding_D15,D10_shift.csv

增加uid_D15,D10的特征,其uid的构造只用card
Total training time is 0:31:22.849713
AUCs: [0.9192863173273331, 0.9393706717839019, 0.9529608934527675, 0.9532486560476418]
Mean AUC: 0.941216634652911
------------------------------
test1 auc:  0.9141129815841496
test2 auc: 0.9224031639508057
实验结果分析: test1提高2.7个点, test2降低0.1个点, 增加后有一定的效果(可以增加)

增加uid_D15,D10的特征,增加(df["day"] == DAY - D1 + 1)的判定条件
Total training time is 0:54:37.009836
AUCs: [0.919155053275225, 0.9392282247833628, 0.9522384129045051, 0.9533908367014245]
Mean AUC: 0.9410031319161294
------------------------------
test1 auc:  0.91415258848449
test2 auc: 0.9223992114060149
实验结果分析: test1提高3个点, test2降低0.1个点

替换uid_D15,D10的特征,使用(df["day"] == DAY - D1 + 1)的判定条件
Total training time is 0:29:29.985973
AUCs: [0.9184449205189439, 0.9391812631211889, 0.9524401976993703, 0.953608230278213]
Mean AUC: 0.940918652904429
------------------------------
test1 auc:  0.9143003346313563
test2 auc: 0.9224648939665394
实验结果分析: test1提高4.6个点, test2提高0.5个点,uid_Dx替换为shift提交能提升效果

D1,D2,D3,D4: 处理shift12个小时依然会出现部分数据不匹配的情况,增加(df["day"] == DAY - D1 + 1)的判定条件
Output:train_target_encoding_D1,D2,D3,D4_shift.csv,test_target_encoding_D1,D2,D3,D4_shift.csv

替换uid_D1,D2,D3,D4的特征,使用(df["day"] == DAY - D1 + 1)的判定条件
Total training time is 0:28:04.256872
AUCs: [0.9185524494166809, 0.9389772178086087, 0.9521186563990063, 0.9536810814427666]
Mean AUC: 0.9408323512667657
------------------------------
test1 auc:  0.9143233408410377
test2 auc: 0.9236411478910467
实验结果分析: test1提高0.2个点, test2提高11.8个点,shift有效

构造delta为1-30的uid_D10_predict特征
Output:uid_D10_pre_isFraud_train,test.csv

增加uid_D10_predict的实验, uid为card+add+pEmail,仅当cnt为1的时候加入,特征为mean_一个特征
test1 auc:  0.9143893746994374
test2 auc: 0.9230331404188018
实验结果分析: test1不变, test2降低6个点, predict作为特征无效,或是构造地不好

利用下一次交易的信息: 当天交易的总金额,平均金额,交易次数
AUCs: [0.919566900378037, 0.9395434478899468, 0.9526953328621638, 0.9536728642003424]
Mean AUC: 0.9413696363326225
------------------------------
test1 auc:  0.9148264675308182
test2 auc: 0.9238156682963823
实验结果分析: test1提升5个万分点, test2提升2个万分点, 该特征有一定的效果

前后时间差特征
AUCs: [0.9190595467723692, 0.9403823361958927, 0.9530128766825393, 0.9549585272420871]
Mean AUC: 0.9418533217232221
------------------------------
test1 auc:  0.9206174423993344
test2 auc: 0.9248250941303581
实验结果分析: test1提升5个千分点, test2提升1个千分点, 该特征有明显的效果

前后交易金额之差特征,上一次交易的D10,D15特征
Total training time is 0:24:41.880247
AUCs: [0.9197405310934579, 0.9407615729510082, 0.953326582922126, 0.9562488439262252]
Mean AUC: 0.9425193827232043
------------------------------
test1 auc:  0.921594149903197
test2 auc: 0.9250462572999005
实验结果分析: test1提升0.97个千分点, test2提升0.22个千分点,该特征有一定的效果


shift范围为[-2,-1,1,2]
Total training time is 0:23:51.834945
AUCs: [0.9192380889457344, 0.9397689419690821, 0.9528906497344074, 0.9555837853235913]
Mean AUC: 0.9418703664932039
------------------------------
test1 auc:  0.9210668432175271
test2 auc: 0.9252818972600017
实验结果分析: test1降低5个千分点, test2提升2.3个千分点,不能证明该特征有效

shift的M系列特征
Total training time is 0:23:48.564437
AUCs: [0.9199333485261098, 0.9400571480184008, 0.9531744148488793, 0.9555016618115062]
Mean AUC: 0.9421666433012241
------------------------------
test1 auc:  0.9206371536234453
test2 auc: 0.9249295503345776
实验结果分析: test1, test2下降,特征无效


shift的D1-4系列特征
Total training time is 0:23:15.342185
AUCs: [0.9208065523632313, 0.940084179538759, 0.9543574290767101, 0.9556619329760343]
Mean AUC: 0.9427275234886836
------------------------------
test1 auc:  0.9224187347144741
test2 auc: 0.926179411666849
实验结果分析: test1提高0.82个千分点, test2提高1.13个千分点,特征有效

前后交易D1-4, D10, D15的差值
Total training time is 0:23:00.878606
AUCs: [0.9202897281853964, 0.9411397683634454, 0.9534773438824167, 0.9550758814823213]
Mean AUC: 0.9424956804783949
------------------------------
test1 auc:  0.9228052541286546
test2 auc: 0.9258379471580679
实验结果分析: test1提高0.38个千分点, test2降低0.34个千分点,不能证明特征有效

shift的D5-9, 11-14系列特征(上一笔和下一笔的交易信息:'D5', 'D6', 'D7', 'D8', 'D9', 'D11', 'D12', 'D13', 'D14')
Total training time is 0:25:04.321979
AUCs: [0.9195091800701065, 0.9411417642702455, 0.9538935614988312, 0.9560598753002716]
Mean AUC: 0.9426510952848637
------------------------------
test1 auc:  0.9230378230974395
test2 auc: 0.9265941066680741
实验结果分析: test1提高0.6个千分点, test2提高0.4个千分点,

前后交易C13,C14的信息
AUCs: [0.919201584000708, 0.9405381760203224, 0.9539505975433087, 0.9554812444795643]
Mean AUC: 0.9422929005109759
------------------------------
test1 auc:  0.9228035856754014
test2 auc: 0.9260583412987725
实验结果分析: test1,test2均下降,C13，C14的shift特征有毒

shift label
Total training time is 0:40:32.513553
AUCs: [0.9416696889928162, 0.9533272959563145, 0.966920989008529, 0.9695094188883546]
Mean AUC: 0.9578568482115035
------------------------------
test1 auc:  0.892761097800655
test2 auc: 0.8954774460192607
实验结果分析: 四折直接起飞, 但是test1和test2降低了很多, test往前跳的时候很多拿不到label,shift之后必须跳到30天之前

uid_target特征
Output: test_uid_target.csv, train_uid_target.csv

全局uid的target mean
Total training time is 1:18:54.005051
AUCs: [0.9199257677975432, 0.9409290700281979, 0.953763675379041, 0.9554070866616658]
Mean AUC: 0.942506399966612
------------------------------
test1 auc:  0.9221741512054289
test2 auc: 0.9259708574292852
实验结果分析: target encoding无效

有效的D系列特征: D1,D2,D3,D4,D10,D15
